# 📊 CSV导出功能详解

## 🎯 功能概述

SmartBLESensor v1.3.0 新增了强化的CSV数据导出功能，支持用户将传感器记录数据导出为标准CSV格式文件，方便后续数据分析和处理。

## ✨ 主要特性

### 🔄 双重导出模式

1. **文件保存模式**
   - 直接保存CSV文件到设备存储
   - 自动生成带时间戳的文件名
   - 显示文件路径、大小和记录数量
   - 支持后续文件管理操作

2. **预览复制模式**
   - 实时预览CSV数据内容
   - 一键复制到系统剪贴板
   - 适合快速数据查看和分享

### 📁 文件管理

- **智能命名**: `sensor_data_YYYYMMDD_HHMMSS.csv`
- **存储位置**: 应用文档目录
- **文件信息**: 显示文件大小和记录数量
- **格式标准**: 符合CSV标准格式

## 🚀 使用方法

### 步骤1: 记录数据
1. 连接蓝牙传感器设备
2. 切换到"记录"标签页
3. 点击播放按钮开始记录数据
4. 观察实时数据记录

### 步骤2: 导出数据
1. 点击右上角的下载图标
2. 选择导出方式：
   - **保存到文件**: 永久保存到设备
   - **预览/复制**: 临时查看和复制

### 步骤3: 文件保存模式
1. 系统显示"正在导出..."加载提示
2. 导出完成后显示成功对话框
3. 查看文件路径、大小和记录数量
4. 点击"确定"完成操作

### 步骤4: 预览复制模式
1. 在预览窗口查看CSV数据
2. 使用滚动查看完整内容
3. 点击"复制"按钮复制到剪贴板
4. 在其他应用中粘贴使用

## 📋 CSV数据格式

### 标准格式
```csv
序号,时间,传感器数据
1,2024-01-15 14:30:01,25.67
2,2024-01-15 14:30:02,25.71
3,2024-01-15 14:30:03,25.69
```

### 字段说明
- **序号**: 数据记录的顺序编号
- **时间**: 精确到秒的时间戳 (YYYY-MM-DD HH:MM:SS)
- **传感器数据**: 保留2位小数的浮点数值

## 🔧 技术实现

### 核心组件
- **CsvExportService**: 专门的CSV导出服务
- **path_provider**: 获取文件系统路径
- **csv**: 标准CSV格式处理
- **intl**: 时间格式化支持

### 关键功能
```dart
// 导出到文件
Future<String> exportSensorRecords(List<SensorRecord> records)

// 格式化文件大小
String formatFileSize(int bytes)

// 生成CSV内容
String _generateCSVContent()
```

## 📱 用户体验优化

### 交互设计
- **直观图标**: 使用下载图标表示导出功能
- **选择对话框**: 清晰的导出方式选择
- **进度反馈**: 导出过程中的加载提示
- **结果展示**: 详细的导出结果信息

### 错误处理
- **数据验证**: 检查是否有数据可导出
- **异常捕获**: 完善的错误处理机制
- **用户提示**: 友好的错误信息显示
- **状态保护**: 防止重复操作

## 🎨 界面展示

### 导出选项对话框
```
┌─────────────────────┐
│      导出数据        │
├─────────────────────┤
│ 共有 150 条记录      │
│                     │
│ 请选择导出方式:      │
├─────────────────────┤
│ [取消] [保存到文件]  │
│       [预览/复制]    │
└─────────────────────┘
```

### 导出成功对话框
```
┌─────────────────────┐
│ ✓ 导出成功          │
├─────────────────────┤
│ 文件已保存到:        │
│ /path/to/file.csv   │
│                     │
│ 文件大小: 12.5 KB    │
│ 记录数量: 150 条     │
├─────────────────────┤
│           [确定]     │
└─────────────────────┘
```

## 🔍 应用场景

### 数据分析
- 导入Excel进行图表分析
- 使用Python/R进行数据科学分析
- 与其他数据处理工具集成

### 数据备份
- 长期数据存储和归档
- 跨设备数据传输
- 数据安全备份

### 报告生成
- 生成数据报告
- 科研论文数据支持
- 工程项目数据记录

## 🚀 未来规划

### v1.4.0 计划功能
- 支持更多导出格式 (JSON, Excel)
- 数据过滤和筛选功能
- 批量文件管理
- 云端同步支持

### 性能优化
- 大数据量导出优化
- 后台导出支持
- 压缩文件支持
- 增量导出功能

---

**SmartBLESensor** - 让传感器数据管理更简单、更专业 🚀
